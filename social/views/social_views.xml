<?xml version="1.0" encoding="utf-8"?>
<odoo>
<data>
    <menuitem
        id="menu_social_global"
        name="Social Marketing"
        web_icon="social,static/description/icon.png"
        sequence="9"
        groups="base.group_user"/>

    <record id="action_social_account_feed" model="ir.actions.act_window">
        <field name="name">Feed</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">social.stream.post</field>
        <field name="view_mode">kanban</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Add your first stream
          </p>
          <p>
            <a href="#" class="o_social_js_add_stream">Add your first stream</a> and start posting.
          </p>
        </field>
        <field name="context">{'search_default_group_by_stream': 1, 'search_default_search_my_streams': 1}</field>
    </record>

    <menuitem
        id="menu_social_feed"
        parent="menu_social_global"
        name="Feed"
        sequence="10"
        action="action_social_account_feed"/>

    <record id="social_stream_post_view_kanban" model="ir.ui.view">
        <field name="name">social.stream.post.view.kanban</field>
        <field name="model">social.stream.post</field>
        <field name="arch" type="xml">
            <kanban class="o_social_stream_post_kanban"
                create="0"
                edit="0"
                records_draggable="false"
                group_create="false"
                js_class="social_stream_post_kanban_view">
                <field name="id"/>
                <field name="author_name"/>
                <field name="post_link"/>
                <field name="published_date"/>
                <field name="account_id"/>
                <field name="message"/>
                <field name="media_type"/>
                <field name="link_url"/>
                <field name="link_image_url"/>
                <field name="link_title"/>
                <field name="link_description"/>
                <field name="stream_post_image_ids"/>
                <field name="stream_post_image_urls"/>
                <field name="stream_id" readonly="1"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="o_social_stream_post_kanban_global p-0 mb-3">
                            <div class="o_social_stream_post_message p-2">
                                <div class="d-flex justify-content-between mb-2">
                                    <t t-set="author_info">
                                        <span class="o_social_stream_post_author_image rounded-circle overflow-hidden"/>
                                        <span class="text-truncate ml-2" t-esc="record.author_name.value or 'Unknown'"/>
                                    </t>

                                    <a t-if="record.post_link.value"
                                        class="o_social_stream_post_author d-flex align-items-center"
                                        t-att-href="record.post_link.value"
                                        t-att-title="record.author_name.value or 'Unknown'"
                                        t-raw="author_info"
                                        target="_blank"/>

                                    <div t-else=""
                                        class="o_social_stream_post_author d-flex align-items-center"
                                        t-raw="author_info"/>

                                    <time class="o_social_stream_post_published_date small"
                                        t-esc="record.published_date.value and record.published_date.value.split(' ')[0] or False"
                                        t-att-title="record.published_date.value"/>
                                </div>
                                <t t-set="has_attachments" t-value="record.stream_post_image_ids.raw_value.length !== 0 || record.link_url.value"/>
                                <div t-attf-class="o_social_stream_post_message_body pb-2 #{has_attachments ? 'o_social_stream_post_with_attachments' : 'mb-2 border-bottom'}">

                                    <div class="o_social_stream_post_message_text overflow-hidden mb-2">
                                        <field name="message"  widget="social_kanban_field_emoji" />
                                    </div>

                                    <div t-if="has_attachments"
                                        class="o_social_stream_post_image d-flex mx-n2 overflow-hidden"
                                        t-att-data-images="record.stream_post_image_urls.raw_value">
                                        <t t-set="image_urls_json" t-value="JSON.parse(record.stream_post_image_urls.raw_value)"/>

                                        <t t-foreach="image_urls_json.length > 2 ? image_urls_json.slice(0, 2) : image_urls_json" t-as="image_url">
                                            <t t-if="image_url_index == 1 &amp; record.stream_post_image_ids.raw_value.length > 2">
                                                <a class="o_social_stream_post_image_more position-relative d-flex ml-1" t-att-data-current-index="1">
                                                    <img class="o_social_stream_post_image_click" t-att-src="image_urls_json[1]" alt="Post Image" />
                                                    <div class="o_social_stream_post_image_more_overlay d-flex align-items-center h-100 w-100 text-white justify-content-center position-absolute h1 m-0" style="user-select: none;">
                                                        +<t t-esc="image_urls_json.length - 2"/>
                                                    </div>
                                                </a>
                                            </t>
                                            <img t-else="" class="o_social_stream_post_image_click" t-att-src="image_url" alt="Post Image" t-att-data-current-index="image_url_index" />
                                        </t>
                                    </div>
                                    <a t-if="record.link_url.value"
                                        class="o_social_stream_post_link p-2 d-flex bg-100"
                                        t-att-href="record.link_url.raw_value"
                                        target="_blank">
                                        <img t-if="record.link_image_url.raw_value" class="mr-2 flex-shrink-0" t-att-src="record.link_image_url.raw_value" alt="Link Image"/>
                                        <div class="o_social_stream_post_link_text">
                                            <div class="o_social_stream_post_link_title font-weight-bold text-truncate" t-esc="record.link_title.value"/>
                                            <div class="o_social_stream_post_link_description text-truncate" t-esc="record.link_description.value"/>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="social_stream_post_view_search" model="ir.ui.view">
        <field name="name">social.stream.post.view.search</field>
        <field name="model">social.stream.post</field>
        <field name="arch" type="xml">
            <search>
                <field name="message" string="Post Message"/>
                <filter string="My Streams" domain="[('stream_id.create_uid','=',uid)]" name="search_my_streams"/>
                <group expand="0" string="Group By">
                    <filter name="group_by_stream" string="By Stream" context="{'group_by': 'stream_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_social_media_post" model="ir.actions.act_window">
        <field name="name">Social Posts</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">social.post</field>
        <field name="view_mode">kanban,calendar,list,form,pivot</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a new post
          </p>
          <p>
            Manage and edit your posts from here.
          </p>
        </field>
    </record>

    <menuitem
        id="menu_social_posts"
        parent="menu_social_global"
        name="Posts"
        sequence="20"
        action="action_social_media_post"/>

    <record id="social_post_view_kanban" model="ir.ui.view">
        <field name="name">social.post.view.kanban</field>
        <field name="model">social.post</field>
        <field name="arch" type="xml">
            <kanban js_class="social_post_kanban_view">
                <field name="message"/>
                <field name="create_uid"/>
                <field name="image_ids" widget="many2many_binary"/>
                <field name="image_urls"/>
                <field name="published_date"/>
                <field name="post_method"/>
                <field name="scheduled_date"/>
                <field name="state"/>
                <field name="has_post_errors"/>
                <field name="media_ids"/>
                <field name="account_ids"/>
                <field name="live_posts_by_media"/>
                <field name="engagement"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_global_click o_social_post_kanban #{record.has_post_errors.raw_value ? 'o_social_post_kanban_error' : ''} d-flex flex-column p-0">
                            <div class="o_social_post_header d-flex justify-content-between border-bottom py-2 px-3">
                                <div>
                                    <t t-foreach="record.media_ids.raw_value" t-as="media_id">
                                        <img class="img mr-1" t-att-title="JSON.parse(record.live_posts_by_media.raw_value)[media_id].join('\n')" t-attf-src="/web/image/social.media/#{media_id}/image/15x15" alt="Media"/>
                                    </t>
                                </div>
                                <div>
                                    <field name="state" widget="label_selection" options="{'classes': {'draft': 'secondary', 'posting': 'warning', 'posted': 'success'}}"/>
                                </div>
                            </div>

                            <t t-set="has_attachments" t-value="record.image_ids.raw_value.length !== 0"/>
                            <div t-attf-class="o_social_stream_post_message_body flex-grow-1 py-2 px-3 #{has_attachments ? 'o_social_stream_post_with_attachments' : 'border-bottom'}">
                                <div t-attf-class="o_social_stream_post_message_text overflow-hidden #{has_attachments ? 'mb-2' : ''}">
                                    <field name="message"  widget="social_kanban_field_emoji" />
                                </div>

                                <div t-if="has_attachments"
                                    class="o_social_stream_post_image d-flex mx-n3 overflow-hidden"
                                    t-att-data-images="record.image_urls.raw_value">
                                    <t t-set="image_urls_json" t-value="JSON.parse(record.image_urls.raw_value)"/>

                                    <t t-foreach="image_urls_json.length > 2 ? image_urls_json.slice(0, 2) : image_urls_json" t-as="image_url">
                                        <t t-if="image_url_index == 1 &amp; record.image_ids.raw_value.length > 2">
                                            <a class="o_social_stream_post_image_more position-relative d-flex ml-1" t-att-data-current-index="1">
                                                <img class="o_social_stream_post_image_click" t-att-src="image_urls_json[1]" alt="Post Image" />
                                                <div class="o_social_stream_post_image_more_overlay d-flex align-items-center h-100 w-100 text-white justify-content-center position-absolute h1 m-0" style="user-select: none;">
                                                    +<t t-esc="image_urls_json.length - 2"/>
                                                </div>
                                            </a>
                                        </t>
                                        <img t-else="" class="o_social_stream_post_image_click" t-att-src="image_url" alt="Post Image" t-att-data-current-index="image_url_index" />
                                    </t>
                                </div>
                            </div>
                            <div class="d-flex flex-grow-0 align-items-center px-3 py-2">
                                <time class="flex-grow-1 small font-weight-bold">
                                    <t t-set="state" t-value="record.state.raw_value"/>
                                    <t t-if="state === 'posted'">
                                        <i class="fa fa-calendar-check-o mr-1" />
                                        <t t-esc="record.published_date.value"/>
                                    </t>
                                    <t t-if="state === 'scheduled'">
                                        <i class="fa fa-calendar mr-1" />
                                        <t t-esc="record.scheduled_date.value"/>
                                    </t>
                                </time>
                                <div class="ml-2 mr-3" title="Engagement">
                                    <i class="fa fa-heart" />
                                    <span t-esc="record.engagement.raw_value"/>
                                </div>

                                <img t-att-src="kanban_image('res.users', 'image', record.create_uid.raw_value)" t-att-title="record.create_uid.value" t-att-alt="record.create_uid.value" class="oe_kanban_avatar rounded-circle"/>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="social_post_view_search" model="ir.ui.view">
        <field name="name">social.post.view.search</field>
        <field name="model">social.post</field>
        <field name="arch" type="xml">
            <search>
                <field name="message" string="Post Message"/>
                <field name="create_uid" string="Published By"/>
                <searchpanel>
                    <field name="state" icon="fa-tasks"/>
                    <field name="account_ids" select="multi" icon="fa-share-alt"/>
                </searchpanel>
            </search>
        </field>
    </record>

    <record id="social_post_view_calendar" model="ir.ui.view">
        <field name="name">social.post.view.calendar</field>
        <field name="model">social.post</field>
        <field name="arch" type="xml">
            <calendar string="Social Posts" date_start="calendar_date" color="state" quick_add="false" mode="week">
                <field name="message"/>
            </calendar>
        </field>
    </record>

    <record id="social_post_view_pivot" model="ir.ui.view">
        <field name="name">social.post.view.pivot</field>
        <field name="model">social.post</field>
        <field name="arch" type="xml">
            <pivot string="Social Posts">
                <field name="create_date" type="row"/>
            </pivot>
        </field>
    </record>

    <record id="social_post_view_list" model="ir.ui.view">
        <field name="name">social.post.view.tree</field>
        <field name="model">social.post</field>
        <field name="arch" type="xml">
            <tree>
                <field name="account_ids" widget="many2many_tags" />
                <field name="message" />
                <field name="state" />
            </tree>
        </field>
    </record>

    <record id="social_post_view_form" model="ir.ui.view">
        <field name="name">social.post.view.form</field>
        <field name="model">social.post</field>
        <field name="arch" type="xml">
            <form string="Social Post" class="o_social_post_view_form">
                <header>
                    <button name="action_post" string="Post" type="object" class="oe_highlight"
                        attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('post_method', '=', 'scheduled')]}"
                        groups="social.group_social_manager" />
                    <button name="action_schedule" string="Schedule" type="object" class="oe_highlight"
                        attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('post_method', '=', 'now')]}"
                        groups="social.group_social_manager" />
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box" attrs="{'invisible': [('id', '=', False)]}">
                        <button class="oe_stat_button" icon="fa-newspaper-o" type="object" name="social_stream_post_action_my"
                            attrs="{'invisible': [('stream_posts_count', '=', 0)]}">
                            <field string="Feed Posts" name="stream_posts_count" widget="statinfo" />
                        </button>
                        <button class="oe_stat_button" icon="fa-thumbs-up"
                            attrs="{'invisible': [('engagement', '=', 0)]}">
                            <field string="Engagement" name="engagement" widget="statinfo" />
                        </button>
                    </div>
                    <group>
                        <group string="Your Post" name="social_post_global">
                            <field name="has_active_accounts" invisible="1" />
                            <field name="account_ids" options="{'no_create': True}" string="Accounts" widget="many2many_checkboxes"
                                 attrs="{'invisible': ['|', ('has_active_accounts', '=', False), ('state', 'in', ['posting', 'posted'])]}" />
                            <div colspan="2" class="alert alert-info o_social_post_no_accounts_available" role="alert" attrs="{'invisible': [('has_active_accounts', '=', True)]}">
                                <p><a href="/web#action=social.action_social_media_configure">Link social accounts</a> before posting.</p>
                            </div>
                            <field name="message" widget="social_text_emojis"
                                 attrs="{'readonly': [('has_active_accounts', '=', False)]}" />
                            <field name="image_ids" widget="many2many_binary" />
                            <field name="post_method" widget="radio" attrs="{'readonly': [('id', '!=', False)]}"/>
                            <field name="scheduled_date" attrs="{'invisible': [('post_method', '=', 'now')], 'required': [('post_method', '!=', 'now')]}" />
                        </group>
                        <group name="previews_placeholder" class="o_social_post_preview_group m-0">
                            <div class="o_social_post_empty_preview o_view_nocontent bg-100"
                                attrs="{'invisible': [('account_ids', '!=', []), ('message', '!=', False), ('message', '!=', '')]}">
                                <div class="o_nocontent_help">
                                    <p class="o_view_nocontent_smiling_face">
                                        Preview your post
                                    </p>
                                    <p>
                                        Write a message to see the preview.
                                    </p>
                                </div>
                            </div>
                        </group>
                        <group name="live_posts" colspan="2" string="Posts By Accounts"
                            attrs="{'invisible': [('state', 'not in', ['posting', 'posted'])]}">
                            <field name="live_post_ids" colspan="2" nolabel="1">
                                <kanban>
                                    <field name="account_id"/>
                                    <field name="state"/>
                                    <field name="failure_reason" />
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div class="o_social_live_post_kanban ml-0 mr-3">
                                                <div class="row">
                                                    <div class="col-md-9 o_social_live_post_kanban_account">
                                                        <field name="account_id" />
                                                    </div>
                                                    <div class="col-md-3 text-right">
                                                        <field name="state" widget="label_selection" options="{'classes': {'ready': 'info', 'posting': 'warning', 'posted': 'success', 'failed': 'danger'}}"/>
                                                    </div>
                                                </div>
                                                <div class="o_social_live_post_kanban_failure_reason mt-2" t-att-title="record.failure_reason.raw_value">
                                                    <field name="failure_reason" />
                                                </div>
                                                <div class="text-right mt-4">
                                                    <button name="action_retry_post" string="Retry" type="object" class="btn btn-primary"
                                                        attrs="{'invisible': [('state', '!=', 'failed')]}">
                                                        Retry
                                                    </button>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                            </field>
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <record id="social_live_post_view_form" model="ir.ui.view">
        <field name="name">social.live.post.view.form</field>
        <field name="model">social.live.post</field>
        <field name="arch" type="xml">
            <form string="Social Post">
                <header>
                    <button name="action_retry_post" string="Retry" type="object" class="oe_highlight" attrs="{'invisible': [('state', '!=', 'failed')]}"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <group>
                        <group name="social_live_post_global">
                            <field name="account_id" options="{'no_open': True}" />
                            <field name="failure_reason" />
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <menuitem
        id="menu_social_configuration"
        parent="menu_social_global"
        name="Configuration"
        sequence="30" />

    <record id="action_social_media_configure" model="ir.actions.act_window">
        <field name="name">Social Media</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">social.media</field>
        <field name="view_mode">kanban,form</field>
    </record>

    <menuitem
        id="menu_social_media_configuration"
        groups="group_social_manager"
        parent="menu_social_configuration"
        name="Social Media"
        sequence="36"
        action="action_social_media_configure"/>

    <record id="social_media_view_kanban" model="ir.ui.view">
        <field name="name">social.media.view.kanban</field>
        <field name="model">social.media</field>
        <field name="arch" type="xml">
            <kanban create="false" class="o_kanban_social_media">
                <field name="id"/>
                <field name="name"/>
                <field name="description"/>
                <field name="media_type"/>
                <field name="has_streams"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_color_5">
                            <div class="o_kanban_image">
                                <img type="open" t-att-src="kanban_image('social.media', 'image', record.id.raw_value)" alt="Social Media"/>
                            </div>
                            <div>
                                <h3 class="mt4"><t t-esc="record.name.value"/></h3>
                                <t t-if="record.description.raw_value" t-raw="record.description.raw_value"/>
                            </div>
                            <div>
                                <button t-if="record.has_streams.raw_value" type="object" class="btn btn-primary float-right" name="action_add_account">Link account</button>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="action_social_stream_configure" model="ir.actions.act_window">
        <field name="name">Social Streams</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">social.stream</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Add a stream
          </p>
          <p>
            Add stream to your dashboard to monitor your social media.
          </p>
        </field>
    </record>

    <menuitem
        id="menu_social_stream_configuration"
        groups="group_social_manager"
        parent="menu_social_configuration"
        name="Social Streams"
        sequence="42"
        action="action_social_stream_configure"/>

    <record id="social_stream_view_tree" model="ir.ui.view">
        <field name="name">social.stream.view.tree</field>
        <field name="model">social.stream</field>
        <field name="arch" type="xml">
            <tree create="0">
                <field name="media_id" />
                <field name="name" />
                <field name="stream_type_id" />
            </tree>
        </field>
    </record>

    <record id="social_stream_view_form" model="ir.ui.view">
        <field name="name">social.stream.view.form</field>
        <field name="model">social.stream</field>
        <field name="arch" type="xml">
            <form string="Social Stream">
                <sheet>
                    <group>
                        <group name="social_stream_global">
                            <field name="media_id" invisible="1" />
                            <field name="account_id" widget="radio"
                                readonly="1"
                                domain="[('media_id', '=', media_id)]"
                                options="{'no_create': True, 'no_open': True}" />
                            <field name="stream_type_type" invisible="1" />
                            <field name="stream_type_id"
                                widget="radio"
                                required="1"
                                domain="[('media_id', '=', media_id)]"
                                options="{'no_create': True, 'no_open': True}"
                                attrs="{'readonly': [('id', '!=', False)]}" />
                            <field name="name" attrs="{'invisible': [('id', '=', False)]}" />
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_social_account_configure" model="ir.actions.act_window">
        <field name="name">Social Accounts</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">social.account</field>
        <field name="view_mode">tree,form</field>
    </record>

    <menuitem
        id="menu_social_account_configuration"
        groups="group_social_manager"
        parent="menu_social_configuration"
        name="Social Accounts"
        sequence="39"
        action="action_social_account_configure"/>

    <record id="social_account_view_list" model="ir.ui.view">
        <field name="name">social.account.view.tree</field>
        <field name="model">social.account</field>
        <field name="arch" type="xml">
            <tree string="Social Accounts" create="0">
                <field name="name" />
            </tree>
        </field>
    </record>

    <record id="social_account_view_form" model="ir.ui.view">
        <field name="name">social.account.view.form</field>
        <field name="model">social.account</field>
        <field name="arch" type="xml">
            <form string="Social Account" create="0">
                <sheet>
                    <field name="image" widget="image" class="oe_avatar"/>
                    <div class="oe_title">
                        <h1>
                            <field name="display_name" placeholder="Name"/>
                        </h1>
                    </div>
                    <group>
                        <group name="social_account_global">
                            <field name="name" />
                            <field name="media_id" options="{'no_open': True}" />
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="action_social_global_settings" model="ir.actions.act_window">
        <field name="name">Settings</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">res.config.settings</field>
        <field name="view_mode">form</field>
        <field name="target">inline</field>
        <field name="context">{'module' : 'social'}</field>
    </record>

    <menuitem
        id="menu_social_global_settings"
        name="Settings"
        parent="menu_social_configuration"
        sequence="33"
        action="action_social_global_settings"
        groups="base.group_no_one" />
</data>
</odoo>
