<?xml version="1.0" encoding="utf-8"?>
<odoo>
     <record id="mrp_workorder_view_tablet_form_inherit_workorder_hr" model="ir.ui.view">
        <field name="name">mrp.workorder.view.tablet.form.inherit.workorder.hr</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp_workorder.mrp_workorder_view_form_tablet"/>
        <field name="arch" type="xml">
            <xpath expr="//div[hasclass('o_workorder_bar_right')]" position="inside">
                <field name="allow_employee" invisible="1"/>
                <span style="width:auto; display:block;">
                    <button class="btn-secondary btn-link o_unblock" type="workorder_event" attrs="{'invisible': [('allow_employee', '=', False)]}" name="popupEmployeeManagement">
                        <span attrs="{'invisible': [('employee_name', '!=', False)]}">Log In </span>
                        <field name="employee_name" attrs="{'invisible': [('employee_name', '=', False)]}" readonly="1" class="me-2"/>
                        <field name="employee_ids" widget="kanban.many2many_avatar_employee" readonly="1" attrs="{'invisible': [('employee_name', '=', False)]}" options="{'no_create': True}"/>
                    </button>
                </span>
            </xpath>
            <xpath expr="//button[@name='button_start']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', '|', '|', ('allow_employee', '=', True), ('is_user_working', '=', True), ('working_state', '=', 'blocked'), ('state', '=', ('done', 'cancel'))]}</attribute>
            </xpath>
            <xpath expr="//button[@name='button_pending']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', '|', ('allow_employee', '=', True), ('is_user_working', '=', False), ('working_state', '=', 'blocked')]}</attribute>
            </xpath>
        </field>
    </record>

    <record id="mrp_workorder_view_form_inherit_workorder_hr" model="ir.ui.view">
        <field name="name">mrp.workorder.view.form.inherit.workorder.hr</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.mrp_production_workorder_form_view_inherit"/>
        <field name="arch" type="xml">
            <field name="production_state" position="after">
                <field name="allow_employee" invisible="1"/>
                <field name="allowed_employees" invisible="1"/>
                <field name="all_employees_allowed" invisible="1"/>
            </field>
            <xpath expr="//field[@name='time_ids']/tree/field[@name='user_id']" position="after">
                <field name="employee_id" attrs="{'column_invisible': [('parent.allow_employee', '=', False)]}" domain="['|',(parent.all_employees_allowed , '=', True),('id', 'in', parent.allowed_employees)]"/>
            </xpath>
            <xpath expr="//field[@name='time_ids']/tree/field[@name='user_id']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('parent.allow_employee', '!=', False)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='check_ids']/tree/field[@name='user_id']" position="after">
                <field name="employee_id" attrs="{'column_invisible': [('parent.allow_employee', '=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='check_ids']/tree/field[@name='user_id']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('parent.allow_employee', '!=', False)]}</attribute>
            </xpath>
        </field>
    </record>

    <record id="mrp_workorder_view_kanban" model="ir.ui.view">
        <field name="name">mrp.workorder.view.kanban.inherit.mrp.workorder.hr</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.workcenter_line_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//t[@name='user_avatar']" position="after">
                <t t-if="record.employee_ids.raw_value"><field name="employee_ids" widget="list.many2many_avatar_user"/></t>
            </xpath>
            <xpath expr="//t[@name='user_avatar']" position='attributes'>
                <attribute name="t-if">record.last_working_user_id.raw_value &amp; ! allow_employee</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.actions.act_window" id="mrp.mrp_workorder_todo">
        <field name="context">{'search_default_my_work_order': 0, 'search_default_ready': 1, 'search_default_waiting': True, 'search_default_progress': True, 'search_default_pending': True}</field>
    </record>

    <record id="mrp_production_workorder_tree_editable_view_inherit_workorder_hr" model="ir.ui.view">
        <field name="name">mrp.production.work.order.tree.editable.inherit.mrp.workorder.hr</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.mrp_production_workorder_tree_editable_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="after">
                    <field name="allowed_employees" invisible="1"/>
                    <field name="all_employees_allowed" invisible="1"/>
                    <field name="employee_assigned_ids" widget="many2many_avatar_user" domain="not all_employees_allowed and [('id','in',allowed_employees)] or []" optional="hidden"/>
            </xpath>
            <xpath expr="//button[@name='open_tablet_view']" position="after">
                <field name="employee_ids" widget="many2many_avatar_employee" readonly="1" nolabel="1"/>
            </xpath>
        </field>
    </record>

    <record id="view_mrp_production_workorder_form_view_filter_my_work_orders" model="ir.ui.view">
        <field name="name">mrp.production.work.order.filter</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.view_mrp_production_workorder_form_view_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='progress']" position="before">
                <field name="connected_employee_ids"/>
                <filter string="My Work Orders" name="my_work_order" domain="[('connected_employee_ids','in',[1])]"/>
                <separator/>
            </xpath>
        </field>
    </record>

    <record id="view_mrp_production_workorder_form_view_search_my_work_orders" model="ir.ui.view">
        <field name="name">mrp.production.work.order.search</field>
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.view_mrp_production_work_order_search"/>
        <field name="arch" type="xml">
            <xpath expr="//filter[@name='progress']" position="after">
                <field name="connected_employee_ids"/>
                <filter string="My Work Orders" name="my_work_order" domain="[('connected_employee_ids','in',[1])]"/>
            </xpath>
        </field>
    </record>

    <record id="mrp_production_workorder_tree_editable_view_connect" model="ir.ui.view">
        <field name="model">mrp.workorder</field>
        <field name="inherit_id" ref="mrp.mrp_production_workorder_tree_editable_view"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position='attributes'>
                <attribute name="js_class">tablet_list_view</attribute>
            </xpath>
        </field>
    </record>
</odoo>
