<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <t t-name="sale_subscription_dashboard.forecast" owl="1">
        <div class="o_action">
            <ControlPanel display="controlPanelDisplay"/>
            <div class="o_content">
                <div class="container o_account_contract_dashboard">
                    <DashboardForecastChart forecastType="'mrr'"/>
                    <DashboardForecastChart forecastType="'contracts'"/>
                </div>
            </div>
        </div>
    </t>

    <t t-name="sale_subscription_dashboard.forecast_chart" owl="1">
        <div class="row box">
            <div class="col-12">
                <t t-if="forecastType === 'mrr'">
                    <t t-call="sale_subscription_dashboard.forecast_summary_mrr"/>
                </t>
                <t t-else="">
                    <t t-call="sale_subscription_dashboard.forecast_summary_contracts"/>
                </t>
            </div>
            <div class="col-md-4 o_forecast_options">
                <table class="table">
                    <tr>
                        <td>Growth Type:</td>
                        <td>
                            <t t-set="input_name" t-value="`growth_type_${forecastType}`"/>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input growth_type" t-att-name="input_name" t-att-id="`${input_name}_linear`" type="radio" t-model="chartState.chartData.growth_type" value="linear"/>
                                <label class="form-check-label" t-att-for="`${input_name}_linear`"> Linear</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input growth_type" t-att-name="input_name" t-att-id="`${input_name}_exponential`" t-model="chartState.chartData.growth_type" type="radio" value="exponential"/>
                                <label class="form-check-label" t-att-for="`${input_name}_exponential`"> Exponential</label>
                            </div>
                        </td>
                    </tr>
                    <t t-foreach="Object.keys(inputs)" t-as="inputKey" t-key="inputKey">
                        <t t-set="inputValues" t-value="inputs[inputKey]"/>
                        <tr>
                            <td><t t-out="inputValues.name"/></td>
                            <td>
                                <div class="input-group">
                                    <t t-set="input_type" t-value="
                                        inputValues.growthTypeInput ?
                                        chartState.chartData.growth_type === 'linear' ? 'linear_growth' : 'expon_growth' :
                                        inputKey"
                                    />
                                    <t t-set="label" t-value="
                                        inputValues.growthTypeInput ?
                                        inputValues.label[input_type] :
                                        inputValues.label"
                                    />
                                    <input
                                        class="form-control o_forecast_input" 
                                        type="number" t-on-change="(e) => this.onForecastInput(e, input_type)"
                                        t-att-value="chartState.chartData[input_type]"/>
                                    <span class="input-group-text">
                                        <t t-out="label"/>
                                    </span>
                                </div>
                            </td>
                        </tr>
                    </t>
                </table>
            </div>
            <div t-ref="forecast-chart-ref" class="col-md-8 position-relative" t-att-id="`forecast_chart_div_${forecastType}`"/>
        </div>
    </t>

    <t t-name="sale_subscription_dashboard.forecast_summary_mrr" owl="1">
        <h3 class="text-center mt32 mb32" id="forecast_summary_mrr">
            In
            <span class="o_blue"><t t-out="chartState.chartData.projection_time"/></span>
            months with
            <span class="o_blue"><t t-out="chartState.chartData.growth_type === 'linear' ? formatMonetaryNumber(chartState.chartData.linear_growth, state.currency_id) : chartState.chartData.expon_growth + '%'"/> <t t-out="chartState.chartData.growth_type"/></span>
            growth and
            <span class="o_red"><t t-out="chartState.chartData.churn + '%'"/></span>
            churn, your MRR will be
            <span class="o_green"><t t-out="formatMonetaryNumber(chartState.computedValue, state.currency_id)"/></span>
        </h3>
    </t>

    <t t-name="sale_subscription_dashboard.forecast_summary_contracts" owl="1">
        <h3 class="text-center mt32 mb32" id="forecast_summary_contracts">
            In
            <span class="o_blue"><t t-out="chartState.chartData.projection_time"/></span>
            months with
            <span class="o_blue"><t t-out="chartState.chartData.growth_type === 'linear' ? chartState.chartData.linear_growth : chartState.chartData.expon_growth + '%'"/> <t t-out="chartState.chartData.growth_type"/></span>
            subscription growth and
            <span class="o_red"><t t-out="chartState.chartData.churn + '%'"/></span>
            churn, your subscription base will be
            <span class="o_green"><t t-out="chartState.computedValue"/></span>
        </h3>
    </t>
</odoo>
