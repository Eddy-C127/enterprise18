<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="l10n_au_action_submit_stp" model="ir.actions.act_window">
        <field name="name">Submit to ATO</field>
        <field name="res_model">l10n_au.stp.submit</field>
        <field name="view_mode">form</field>
        <field name="context">{'default_l10n_au_stp_id': active_id}</field>
        <field name="target">new</field>
    </record>

    <record id="l10n_au_stp_form_wizard" model="ir.ui.view">
        <field name="name">l10n_au.stp.form</field>
        <field name="model">l10n_au.stp</field>
        <field name="arch" type="xml">
            <form string="Single Touch Payroll">
                <field name="state" invisible="1"/>
                <field name="xml_filename" invisible="1"/>
                <header>
                    <field name="state" widget="statusbar"/>
                    <button name="l10n_au_hr_payroll_account.l10n_au_action_submit_stp" string="Submit to ATO" type="action"
                        class="btn-primary" invisible="state in ['sent']"/>
                </header>
                <sheet>
                    <div class="alert alert-warning" role="alert" invisible="not warning_message">
                        <field name="warning_message" style="white-space: pre-wrap;"/>
                    </div>
                    <group>
                        <group>
                            <field name="payevent_type" readonly="state == 'sent'"/>
                            <field name="previous_report_id" invisible="payevent_type == 'submit'"
                                required="payevent_type == 'update'" readonly="state == 'sent'"/>
                            <field name="ffr" invisible="payevent_type == 'submit'" readonly="state == 'sent'"/>
                            <field name="payslip_batch_id" readonly="state == 'sent'"/>
                        </group>
                        <group>
                            <field name="company_id" readonly="state != 'draft'"/>
                        </group>
                    </group>
                    <div invisible="state == 'draft'">
                        <h2>Generation Complete</h2>
                        <p invisible="not xml_file">
                            <field name="xml_file" readonly="1" filename="xml_filename"/>
                            <field name="xml_validation_state" widget="state_selection" nolabel="1"/>
                            <field name="error_message" invisible="xml_validation_state != 'invalid'" nolabel="1"/>
                        </p>
                    </div>
                    <field name="payslip_ids" readonly="state == 'sent'" invisible="payevent_type == 'adjust'">
                        <list no_create="1">
                            <field name="company_id" column_invisible="1"/>
                            <field name="number"/>
                            <field name="name"/>
                            <field name="date_from"/>
                            <field name="date_to"/>
                            <field name="employee_id"/>
                            <field name="state"/>
                            <field name="l10n_au_stp_status" optional="show" widget="badge"
                                decoration-success="l10n_au_stp_status == 'sent'"
                                decoration-info="l10n_au_stp_status == 'ready'"
                                decoration-warning="l10n_au_stp_status == 'error'" />
                        </list>
                    </field>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>

    <record id="l10n_au_stp_view_tree" model="ir.ui.view">
        <field name="name">l10n_au.stp.list</field>
        <field name="model">l10n_au.stp</field>
        <field name="arch" type="xml">
            <list string="Single Touch Payroll">
                <field name="name"/>
                <field name="payevent_type" />
                <field name="activity_ids" widget="list_activity"/>
                <field name="activity_date_deadline" string="Deadline" widget="remaining_days" />
                <field name="payslip_batch_id" optional="hide"/>
                <field name="state" widget="badge"
                decoration-success="state == 'sent'"
                decoration-info="state == 'ready'"
                decoration-warning="state == 'error'" />
            </list>
        </field>
    </record>

    <record id="l10n_au_stp_view_search" model="ir.ui.view">
        <field name="name">l10n_au.stp.view.search</field>
        <field name="model">l10n_au.stp</field>
        <field name="arch" type="xml">
            <search string="Single Touch Payroll">
                <field name="payslip_ids" string="Employee" filter_domain="[('payslip_ids.employee_id', 'ilike', self)]"/>
                <field name="payslip_batch_id"/>
                <field name="payslip_ids"
                    filter_domain="['|', ('payslip_ids.number', 'ilike', self), ('payslip_ids.name', 'ilike', self)]"/>
                <filter name="todo" string="To Do" domain="[('state', '!=', 'sent')]"/>
                <filter name="sent" string="Submitted" domain="[('state', '=', 'sent')]"/>
                <group expand="0" string="Group By">
                    <filter name="filter_payevent_type" string="Pay Event Type" context="{'group_by': 'payevent_type'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="l10n_au_stp_action" model="ir.actions.act_window">
        <field name="name">Single Touch Payroll</field>
        <field name="res_model">l10n_au.stp</field>
        <field name="view_mode">list,form</field>
        <field name="target">current</field>
        <field name="context">{'search_default_todo': 1}</field>
    </record>

    <menuitem
        id="menu_l10n_au_l10n_au_stp"
        name="Single Touch Payroll"
        action="l10n_au_stp_action"
        parent="l10n_au_hr_payroll.menu_reporting_l10n_au"
        sequence="150"
    />

</odoo>
