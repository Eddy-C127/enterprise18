<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">
    <t t-extend="PaymentScreen-Paymentlines">
       <t t-jquery='.delete-button' t-operation='replace'>
            <t t-if="line &amp;&amp; line.payment_status &amp;&amp; ['done', 'reversed', 'reversing'].includes(line.payment_status)">
                <td/>
            </t>
            <t t-else=''>
                <td class='delete-button' t-att-data-cid='line.cid' aria-label="Delete" title="Delete">
                    <i class='fa fa-times-circle'/> 
                </td>
            </t>
        </t>
        <t t-jquery='.col-tendered.edit' t-operation='replace'>
            <t t-if="line &amp;&amp; line.payment_status &amp;&amp; ['done', 'waitingCard', 'waiting', 'reversing', 'reversed'].includes(line.payment_status)">
                <td class='col-tendered'>
                    <t t-esc='widget.inputbuffer' />
                </td>
            </t>
            <t t-else="">
                <td class='col-tendered edit'>
                    <t t-esc='widget.inputbuffer' />
                </td>
            </t>
        </t>
        <t t-jquery='.paymentline' t-operation='append'>
            <t t-if="line &amp;&amp; line.get_amount() != 0 &amp;&amp; line.payment_status">
                <tr class="send_request paymentline electronic_payment"/>
                <tr class="paymentline electronic_payment">
                    <t t-if="line.payment_status=='pending'">
                        <td colspan="3">
                            Payment request pending
                        </td>
                        <td colspan="2" class='button send_payment_request highlight' title="Send Payment Request" t-att-data-cid='line.cid'>
                            Send
                        </td>
                    </t>
                    <t t-if="line.payment_status=='retry'">
                        <td colspan="3">
                            Retry Electronic payment
                        </td>
                        <td colspan="2" class='button send_payment_request highlight' title="Send Payment Request" t-att-data-cid='line.cid'>
                            Retry
                        </td>
                    </t>
                    <t t-if="line.payment_status=='force_done'">
                        <td colspan="3">
                            Connection error
                        </td>
                        <td colspan="2" class='button send_force_done' title="Force Done" t-att-data-cid='line.cid'>
                            Force done
                        </td>
                    </t>
                    <t t-elif="line.payment_status=='waitingCard'">
                        <td colspan="3">
                            Waiting for card
                        </td>
                        <td colspan="2" class='button send_payment_cancel' title="Cancel Payment Request" t-att-data-cid='line.cid'>
                            Cancel
                        </td>
                    </t>
                    <t t-elif="['waiting', 'waitingCancel'].includes(line.payment_status)">
                        <td colspan="3">
                            Request send to terminal
                        </td>
                        <td colspan="2">
                            <i class='fa fa-spinner fa-spin' role='img'/>
                        </td>
                    </t>
                    <t t-elif="line.payment_status == 'reversing'">
                        <td colspan="3">
                            Reverse request sent to terminal
                        </td>
                        <td colspan="2">
                            <i class='fa fa-spinner fa-spin' role='img'/>
                        </td>
                    </t>
                    <t t-elif="['done'].includes(line.payment_status)">
                        <t t-if="line.reversal">
                            <td colspan="3">
                                Payment Successful
                            </td>
                            <td colspan="2" class='button send_payment_reverse' title="Reverse Payment" t-att-data-cid='line.cid'>
                                Reverse
                            </td>
                        </t>
                        <t t-else="">
                            <td colspan="4">
                                Payment Successful
                            </td>
                        </t>
                    </t>
                </tr>
            </t>
            <t t-elif="line &amp;&amp; line.payment_status == 'reversed'">
                <tr class="send_request paymentline electronic_payment"/>
                <tr class="paymentline electronic_payment">
                    <td colspan="4">
                        Payment reversed
                    </td>
                </tr>
            </t>
        </t>
    </t>

    <t t-extend="OrderReceipt">
        <t t-jquery='.after-footer' t-operation='append'>
            <t t-foreach='paymentlines' t-as='line'>
                <t t-if='line.ticket'>
                    <br />
                    <div class="pos-payment-terminal-receipt">
                        <t t-raw='line.ticket'/>
                    </div>
                </t>
            </t>
        </t>
    </t>

    <t t-name="IoTErrorPopupWidget">
        <div role="dialog" class="modal-dialog">
            <div class="popup popup-error">
                <p class="title"><t t-esc="widget.options.title || 'Error' " /></p>
                <div class="body">
                    <p>Please check if the IoT Box is still connected.</p>
                    <p>If you are on a secure server (HTTPS) check if you accepted the certificate:</p>
                    <ul>
                        <li>Access your <a t-att-href="'https://' + widget.options.url" target="_blank">IoT Box Homepage</a></li>
                        <li>Click on Advanced/Show Details/Details/More information</li>
                        <li>Click on Proceed to .../Add Exception/Visit this website/Go on to the webpage</li>
                        <li>Firefox only : Click on Confirm Security Exception</li>
                        <li>Close this window and try again</li>
                    </ul>
                </div>
                <div class="footer">
                    <div class="button cancel">
                        Ok
                    </div>
                </div>
            </div>
        </div>
    </t>

    <t t-name="CloseSession">
        <button t-att-attrs="widget.attrs.attrs" t-att-states="widget.attrs.states"
                class="btn btn-primary">
            <span t-esc="widget.attrs.string"/>
        </button>
    </t>

</templates>
