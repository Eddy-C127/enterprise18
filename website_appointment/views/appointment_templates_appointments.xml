<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Templates inherited -->

    <template id="appointments_list_layout" name="Online Appointment: Appointments List Layout" inherit_id="appointment.appointments_list_layout">
        <xpath expr="//t[@t-call='portal.portal_layout']" position="attributes">
            <attribute name="t-call">website.layout</attribute>
        </xpath> 
        <xpath expr="//div[hasclass('o_appointment_choice')]" position="before">
            <t t-call="website_appointment.website_calendar_index"/>
        </xpath>
    </template>

    <template id="appointment_info" name="Online Appointment: Appointment Info" inherit_id="appointment.appointment_info" track="1">
        <xpath expr="//t[@t-call='portal.portal_layout']" position="attributes">
            <attribute name="t-call">website.layout</attribute>
        </xpath>
        <xpath expr="//div[@id='wrap']" position="attributes">
            <attribute name="class" value=""/>
        </xpath>
        <xpath expr="//t[@t-set='o_portal_fullwidth_alert']" position="replace"/>
        <xpath expr="//div[hasclass('o_appointment')]" position="before">
            <nav t-if="appointment_type.category == 'website' and len(available_appointments) != 1" class="navbar navbar-light border-top shadow-sm d-print-none">
                <div class="container">
                    <a t-attf-href="/appointment?#{keep_query('filter_appointment_type_ids', 'filter_staff_user_ids', 'invite_token')}"
                        class="navbar-brand h4 my-0 mr-auto">
                        <i class="fa fa-long-arrow-left text-primary mr-2"/>All Appointments
                    </a>
                </div>
            </nav>
        </xpath>
        <xpath expr="//div[hasclass('o_calendar_intro')]" position="before">
            <t t-set="no_users" t-value="not appointment_type.staff_user_ids"/>
            <t t-set="no_slots" t-value="not appointment_type.slot_ids"/>
            <div t-if="no_users or no_slots" class="o_appointment_missing_configuration alert alert-info rounded-0 mb-0 o_not_editable d-none" groups="appointment.group_appointment_manager">
                This appointment type has no availabilities because it
                <t t-if="no_users"> has no staff assigned</t>
                <t t-if="no_users and no_slots"> and</t>
                <t t-if="no_slots">
                    does not have any opening hours configured
                </t>
                <a t-attf-href="/web#model=#{main_object._name}&amp;id=#{main_object.id}&amp;menu_id=#{backend_menu_id}" class="d-block">
                    <i class="fa fa-arrow-right mr-2"/><em>Configure <t t-out="appointment_type.name"/></em>
                </a>
            </div>
        </xpath>
    </template>

    <!-- Pages -->

    <template id="appointments_cards_layout" name="Appointment Types">
        <t t-call="website.layout">
            <div id="wrap" class="o_appointment_index h-100">
                <t t-call="website_appointment.website_calendar_index"/>
                <t t-call="website_appointment.website_calendar_index_topbar"/>
                <div class="oe_structure"/>
                <div class="o_appointment_appointments_list h-100 mb-5">
                    <div class="container">
                        <div id="o_appointment_index_main_col" class="col-md pt-5 px-0 appointments_list_columns">
                            <div class="row">
                                <t t-call="website_appointment.appointments_cards"/>
                            </div>
                        </div>
                    </div>
                    <div class="oe_structure oe_empty"/>
                </div>
            </div>
        </t>
    </template>

    <!-- Enable the customize option for the 2 layouts (cards and list)-->
    <template id="website_calendar_index" name="Online Appointment"/>
    <template id="opt_appointments_list_cards" inherit_id="website_appointment.website_calendar_index" active="True" customize_show="True" name="Card Design"/>

    <template id="website_calendar_index_topbar" name="Topbar">
        <nav class="navbar navbar-light border-top shadow-sm d-print-none">
            <div class="container">
                <div class="d-flex flex-column flex-sm-row justify-content-between w-100">
                    <span class="navbar-brand h4 my-0 mr-auto">Choose Your Appointment</span>
                    <div class="d-flex flex-wrap pl-sm-3 pr-0">
                        <t t-call="website_appointment.appointments_search_box">
                            <t t-set="_placeholder"><t t-out="'Search an appointment...'"/></t>
                        </t>
                    </div>
                </div>
            </div>
        </nav>
    </template>

    <template id="appointments_search_box" inherit_id="website.website_search_box" primary="True">
        <xpath expr="//div[@role='search']" position="replace">
            <form t-attf-class="o_wait_lazy_js w-100 my-1 my-lg-0 #{_classes}"
                t-att-action="action if action else '/appointment'" method="get">
                <t t-set="search" t-value="current_search"/>
                <t t-set="placeholder" t-value="placeholder or _placeholder"/>
                <t>$0</t>
                <input type="hidden" name="filter_appointment_type_ids" t-att-value="filter_appointment_type_ids"/>
                <input type="hidden" name="filter_staff_user_ids" t-att-value="filter_staff_user_ids"/>
                <input type="hidden" name="invite_token" t-att-value="invite_token"/>
            </form>
        </xpath>
    </template>

    <template id="appointments_cards" name="Appointments Cards">
        <t t-if="not appointment_types">
            <div class="col-12">
                <div class="h2 mb-3">No appointment found.</div>
                <div class="alert alert-info text-center" groups="appointment.group_appointment_manager">
                    <p class="m-0">Use the top button '<b>+ New</b>' to create an appointment type.</p>
                </div>
            </div>
        </t>
        <div t-foreach="appointment_types" t-as="appointment" class="col-md-6 col-lg-4 mb-4">
            <article class="h-100 card border-0 shadow" itemscope="itemscope" itemtype="http://schema.org/Appointments">
                <a t-attf-href="/appointment/#{appointment.id}?#{keep_query('filter_appointment_type_ids', 'filter_staff_user_ids', 'invite_token')}"
                    class="text-reset text-decoration-none h-100">
                    <div class="h-100 no-gutters">
                        <header class="overflow-hidden bg-secondary col-12 rounded-top">
                            <div class="d-block h-100 w-100">
                                <t t-call="website.record_cover">
                                    <t t-set="_record" t-value="appointment"/>
                                    <small t-if="not appointment.website_published" class="o_appointment_unpublished bg-danger position-absolute w-100 text-right" groups="base.group_user">
                                        <i class="fa fa-ban mr-2"/>Unpublished
                                    </small>
                                </t>
                            </div>
                        </header>
                        <div class="col-12">
                            <main class="card-body">
                                <!-- Title -->
                                <h5 t-attf-class="card-title mt-2 mb-0 text-truncate">
                                    <span t-field="appointment.name" itemprop="name"/>
                                </h5>
                                <div itemprop="location" class="mt-3 text-truncate d-flex">
                                    <div><i class="fa fa-map-marker mr-2"/></div>
                                    <div t-if="appointment.location_id" t-field="appointment.location_id" t-options="{'widget': 'contact', 'fields': ['name']}"></div>
                                    <div t-else="" class="o_not_editable">Online</div>
                                </div>
                            </main>
                        </div>
                    </div>
                </a>
            </article>
        </div>
        <div class="container form-inline w-100 justify-content-center my-3">
            <t t-call="website.pager"/>
        </div>
    </template>
</odoo>
