<?xml version="1.0" encoding="utf-8"?>
<templates>

     <div t-name="spreadsheet_edition.FilterComponent" class="o_filter_component" owl="1">
        <div
            t-attf-class="o_topbar_filter_icon fa fa-filter {{activeFilter ? 'btn-link': ''}}"
            title="Filters"
            t-on-click="toggleDropdown"></div>
    </div>

    <div t-name="spreadsheet_edition.RelationTags"/>

    <div t-name="spreadsheet_edition.StandaloneMany2OneField"/>

    <div t-name="spreadsheet_edition.GlobalFiltersSidePanel" class="o_spreadsheet_global_filters_side_panel" owl="1">
        <div class="o_side_panel_section pivot_filter_section" t-foreach="filters" t-as="filter" t-key="'filter_' + filter_index">
            <div class="pivot_filter">
                <div class="o_side_panel_title">
                    <span class="o_side_panel_filter_label" t-esc="filter.label"/>
                </div>
                <div class="pivot_filter_input">
                    <t t-set="filterValue" t-value="getters.getGlobalFilterValue(filter.id)"/>
                    <input t-if="filter.type === 'text'"
                        class="o_input"
                        t-att-value="filterValue"
                        t-on-change="(e) => this.onTextInput(filter.id, e.target.value)"/>
                    <span t-if="filter.type === 'relation'" t-on-click.stop="">
                        <X2ManyTagSelector
                            relatedModel="filter.modelName"
                            selectedValues="filterValue"
                            t-key="filter.id + filter.modelName"
                            onValueChanged="(value) => this.onTagSelected(filter.id, value)"
                        />
                    </span>
                    <DateFilterValue
                        t-if="filter.type === 'date'"
                        period="filterValue &amp;&amp; filterValue.period"
                        yearOffset="filterValue &amp;&amp; filterValue.yearOffset"
                        type="filter.rangeType"
                        onTimeRangeChanged="(value) => this.onDateInput(filter.id, value)"
                    />
                    <i  t-if="getters.isFilterActive(filter.id)"
                        class="fa fa-times btn btn-link text-muted o_side_panel_filter_icon"
                        title="Clear"
                        t-on-click="() => this.onClear(filter.id)"/>
                    <i t-if="!isReadonly"
                        class="fa fa-cog btn btn-link text-muted o_side_panel_filter_icon"
                        title="Edit"
                        t-on-click="() => this.onEdit(filter.id)"/>
                </div>
            </div>
        </div>
        <div t-if="!isReadonly" class="o_side_panel_section">
            <div class="o_add_filter">Add a new filter...</div>
            <div class="o-sidePanelButtons">
                <button t-on-click="newDate" class="o-sidePanelButton o_global_filter_new_time">
                    <span>Date</span>
                </button>
                <button t-on-click="newRelation" class="o-sidePanelButton o_global_filter_new_relation">
                    <span>Relation</span>
                </button>
                <button t-on-click="newText" class="o-sidePanelButton o_global_filter_new_text">
                    <span>Text</span>
                </button>
            </div>
        </div>
    </div>


    <div t-name="spreadsheet_edition.FilterEditorSidePanel" class="o_spreadsheet_filter_editor_side_panel" owl="1">
        <div class="o_side_panel_section">
            <div class="o_side_panel_title">Label</div>
            <div t-att-class="missingLabel ? 'o_field_invalid' : ''" class="o_required_modifier">
                <input
                    class="o_input o_global_filter_label"
                    t-model="state.label"
                    t-att-placeholder="placeholder"/>
            </div>
        </div>
        <div class="o_side_panel_section o_side_panel_related_model" t-if="state.type === 'relation'">
            <div class="o_side_panel_title">Related Model</div>
            <div t-att-class="missingModel ? 'o_field_invalid' : ''" class="o_required_modifier">
                <ModelSelector
                    value="state.relation.relatedModel.label"
                    models="relatedModels"
                    onModelSelected.bind="onModelSelected"
                />
            </div>
        </div>
        <div t-if="state.type === 'date'" class="o_side_panel_section">
            <div class="o_side_panel_title">Time Range</div>
                <select
                    t-model="state.date.type"
                    t-on-change="onDateOptionChange"
                    class="o_input">
                    <t t-foreach="dateRangeTypes" t-as="range" t-key="range.type">
                        <option t-if="isDateTypeSelected(range.type)" selected="1" t-att-value="range.type">
                            <t t-esc="range.description"/>
                        </option>
                        <option t-else="" t-att-value="range.type">
                            <t t-esc="range.description"/>
                        </option>
                    </t>
            </select>
        </div>
        <div class="o_side_panel_section" t-if="state.type !== 'relation' || state.relation.relatedModel.technical">
            <div class="o_side_panel_title">Default Value</div>
            <DateFilterValue
                t-if="state.type === 'date'"
                period="state.date.defaultValue.period"
                yearOffset="state.date.defaultValue.yearOffset"
                type="state.date.type"
                onTimeRangeChanged.bind="onTimeRangeChanged"
            />
            <input t-if="state.type === 'text'"
                class="o_input o_global_filter_default_value"
                t-model="state.text.defaultValue"/>
            <X2ManyTagSelector
                t-if="state.type === 'relation' and state.relation.relatedModel.technical"
                relatedModel="state.relation.relatedModel.technical"
                selectedValues="state.relation.defaultValue"
                t-key="state.relation.relatedModel.technical"
                onValueChanged.bind="onValuesSelected"
            />
        </div>
        <div class="o_side_panel_section" t-if="state.type !== 'relation' || state.relation.relatedModel.technical">
            <div class="o_side_panel_title o_field_matching_title">Field Matching</div>
            <div class="text-muted">
                Match this filter to a field for each pivot/list
            </div>
            <div t-foreach="pivotIds" t-as="pivotId" t-key="pivotId" t-att-class="missingPivotField ? 'o_field_invalid' : ''" class="o_pivot_field_matching o_required_field">
                <t t-set="pivotModel" t-value="getters.getSpreadsheetPivotModel(pivotId)"/>
                <t t-if="pivotModel !== undefined">
                    <div><t t-esc="modelDisplayNames.pivots[pivotId]"/> <span class="o_pivot_model_technical_name text-muted">(Pivot #<t t-esc="pivotId"/>)</span></div>
                    <FieldSelectorAdapter
                        Component="FieldSelectorWidget"
                        model="getters.getPivotDefinition(pivotId).model"
                        fields="pivotModel.getFields()"
                        type="state.type"
                        relatedModel="state.relation.relatedModel.technical"
                        selected="state.pivotFields[pivotId]"
                        t-key="pivotId + (state.relation.relatedModel.technical or 'not_defined')"
                        onFieldChainChanged="chain => this.onSelectedPivotField(pivotId, chain)"
                    />
                </t>
            </div>
            <div t-foreach="listIds" t-as="listId" t-key="listId" t-att-class="missingListField ? 'o_field_invalid' : ''" class="o_pivot_field_matching o_required_field">
                <div><t t-esc="modelDisplayNames.lists[listId]"/> <span class="o_pivot_model_technical_name text-muted">(List #<t t-esc="listId"/>)</span></div>
                <FieldSelectorAdapter
                    Component="FieldSelectorWidget"
                    model="getters.getListDefinition(listId).model"
                    fields="getters.getSpreadsheetListModel(listId).getFields()"
                    type="state.type"
                    relatedModel="state.relation.relatedModel.technical"
                    selected="state.listFields[listId]"
                    t-key="listId + (state.relation.relatedModel.technical or 'not_defined')"
                    onFieldChainChanged="chain => this.onSelectedListField(listId, chain)"
                    />
            </div>
        </div>
        <div class="o_side_panel_section o-sidePanelButtons">
            <button t-if="props.id" t-on-click="onDelete" class="o-sidePanelButton o_global_filter_delete text-danger">Remove</button>
            <button t-on-click="onCancel" class="o-sidePanelButton o_global_filter_cancel">Cancel</button>
            <button t-on-click="onSave" class="o-sidePanelButton o_global_filter_save">Save</button>
        </div>
    </div>

    <div t-name="spreadsheet_edition.DateFilterValue" class="date_filter_values" owl="1">
        <select t-if="!isYear()" class="o_input" t-on-change="onPeriodChanged">
            <option value="empty"/>
            <t t-set="type" t-value="props.type"/>
            <t t-foreach="dateOptions(type)" t-as="periodOption" t-key="periodOption.id">
                <option t-if="isSelected(periodOption.id)" selected="1" t-att-value="periodOption.id">
                    <t t-esc="periodOption.description"/>
                </option>
                <option t-else="" t-att-value="periodOption.id">
                    <t t-esc="periodOption.description"/>
                </option>
            </t>
        </select>
        <YearPicker 
            date="date"
            onDateTimeChanged.bind="onYearChanged"
        />
    </div>



</templates>
