<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="cfdi_cartaporte_comex" inherit_id="l10n_mx_edi_stock.cfdi_cartaporte">
        
        <xpath expr="//*[name()='cartaporte31:CartaPorte']" position="attributes">
            <attribute name="t-att-EntradaSalidaMerc">entrada_salida_merc</attribute>
        </xpath>

        <xpath expr="//*[local-name()='Ubicacion' and @TipoUbicacion='Destino']/*[local-name()='Domicilio']" position="attributes">
            <attribute name="t-att-Colonia">destino['domicilio']['colonia']</attribute>
            <attribute name="t-att-Municipio">destino['domicilio']['municipio']</attribute>
        </xpath>

        <xpath expr="//*[local-name()='Ubicacion' and @TipoUbicacion='Origen']/*[local-name()='Domicilio']" position="attributes">
            <attribute name="t-att-Colonia">origen['domicilio']['colonia']</attribute>
            <attribute name="t-att-Municipio">origen['domicilio']['municipio']</attribute>c
        </xpath>

        <xpath expr="//*[name()='cartaporte31:Mercancia']" position="attributes">
            <attribute name="t-att-FraccionArancelaria">move.product_id.l10n_mx_edi_tariff_fraction_id.code if record.l10n_mx_edi_external_trade else None</attribute>
            <attribute name="t-att-MaterialPeligroso">
                move.product_id.l10n_mx_edi_hazardous_material_code == '0' and 'No' or
                move.product_id.l10n_mx_edi_hazardous_material_code and 'SÃ­' or
                None
            </attribute>
            <attribute name="t-att-CveMaterialPeligroso">
                move.product_id.l10n_mx_edi_hazardous_material_code
                if move.product_id.l10n_mx_edi_hazardous_material_code and move.product_id.l10n_mx_edi_hazardous_material_code != '0'
                else None
            </attribute>
            <attribute name="t-att-Embalaje">
                move.product_id.l10n_mx_edi_hazard_package_type
                if move.product_id.l10n_mx_edi_hazardous_material_code and move.product_id.l10n_mx_edi_hazardous_material_code != '0'
                else None
            </attribute>
            <attribute name="t-att-DescripEmbalaje">
                move.picking_id._l10n_mx_edi_get_packaging_desc(move.product_id.l10n_mx_edi_hazard_package_type)
                if move.product_id.l10n_mx_edi_hazardous_material_code and move.product_id.l10n_mx_edi_hazardous_material_code != '0'
                else None
            </attribute>
            <attribute name="t-att-TipoMateria">move.product_id.l10n_mx_edi_material_type if record.l10n_mx_edi_external_trade else None</attribute>
            <attribute name="t-att-DescripcionMateria">move.product_id.l10n_mx_edi_material_description if (record.l10n_mx_edi_external_trade and move.product_id.l10n_mx_edi_material_type == '05') else None</attribute>
        </xpath>

        <xpath expr="//*[name()='cartaporte31:Seguros']" position="attributes">
            <attribute name="t-att-AseguraMedAmbiente">
                record.l10n_mx_edi_vehicle_id.environment_insurer
                if any(moves.product_id.filtered(lambda c: c.l10n_mx_edi_hazardous_material_code and c.l10n_mx_edi_hazardous_material_code != '0'))
                else None
            </attribute>
            <attribute name="t-att-PolizaMedAmbiente">
                record.l10n_mx_edi_vehicle_id.environment_insurance_policy
                if any(moves.product_id.filtered(lambda c: c.l10n_mx_edi_hazardous_material_code and c.l10n_mx_edi_hazardous_material_code != '0'))
                else None
            </attribute>
        </xpath>

        <xpath expr="//*[name()='cartaporte31:CantidadTransporta']" position="before">
            <cartaporte31:DocumentacionAduanera
                xmlns:cartaporte31="http://www.sat.gob.mx/CartaPorte30"
                t-if="record.l10n_mx_edi_external_trade"
                t-att-TipoDocumento="tipo_documento"
                t-att-NumPedimento="num_pedimento"
                t-att-IdentDocAduanero="ident_doc_aduanero"
                t-att-RFCImpo="rfc_impo"
            />
        </xpath>

    </template>
</odoo>
